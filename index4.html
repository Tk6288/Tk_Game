<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº‘é“¾ä¹¡åœŸ - å†œäº§ç›´æ’­åŸ¹è®­</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f3f4f6; padding-bottom: 80px; }
        .hide { display: none; }
        .nav-active { color: #16a34a; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .check-anim { animation: check-pop 0.3s ease-out forwards; }
        @keyframes check-pop {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .like-anim { animation: like-bounce 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes like-bounce {
            0% { transform: scale(1); }
            50% { transform: scale(1.4); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="bg-green-600 text-white p-4 sticky top-0 z-50 shadow-md">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-2" onclick="app.navigate('home')">
                <i class="fa-solid fa-leaf text-xl"></i>
                <h1 class="text-lg font-bold">äº‘é“¾ä¹¡åœŸ</h1>
            </div>
            <div class="flex items-center gap-3">
                <div class="text-sm bg-green-700 px-3 py-1 rounded-full flex items-center">
                    <i class="fa-solid fa-coins mr-1"></i> <span id="header-points">100</span>
                </div>
                <div class="relative cursor-pointer" onclick="alert('è´­ç‰©è½¦')">
                    <i class="fa-solid fa-cart-shopping text-xl"></i>
                    <span id="cart-badge" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center hidden">0</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="app-container" class="max-w-md mx-auto p-4 min-h-screen">
        <!-- Dynamic Content Injected Here -->
    </main>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 z-50">
        <div class="flex justify-around items-center h-16 max-w-md mx-auto">
            <button onclick="app.navigate('home')" class="nav-btn flex flex-col items-center justify-center w-full h-full text-gray-400" id="nav-home">
                <i class="fa-solid fa-house text-xl mb-1"></i>
                <span class="text-[10px]">é¦–é¡µ</span>
            </button>
            <button onclick="app.navigate('hot-courses')" class="nav-btn flex flex-col items-center justify-center w-full h-full text-gray-400" id="nav-hot-courses">
                <i class="fa-solid fa-fire text-xl mb-1"></i>
                <span class="text-[10px]">çƒ­é”€è¯¾ç¨‹</span>
            </button>
            <button onclick="app.navigate('community')" class="nav-btn flex flex-col items-center justify-center w-full h-full text-gray-400" id="nav-community">
                <i class="fa-solid fa-users-line text-xl mb-1"></i>
                <span class="text-[10px]">ç¤¾åŒº</span>
            </button>
            <button onclick="app.navigate('courses-points')" class="nav-btn flex flex-col items-center justify-center w-full h-full text-gray-400" id="nav-courses-points">
                <i class="fa-solid fa-graduation-cap text-xl mb-1"></i>
                <span class="text-[10px]">è¯¾ç¨‹/ç§¯åˆ†</span>
            </button>
            <button onclick="app.navigate('mine')" class="nav-btn flex flex-col items-center justify-center w-full h-full text-gray-400" id="nav-mine">
                <i class="fa-regular fa-user text-xl mb-1"></i>
                <span class="text-[10px]">æˆ‘çš„</span>
            </button>
        </div>
    </nav>

    <script>
        // Data Store
        const db = {
            user: {
                name: "ç‹å¤§ä¼¯",
                email: "wang@nongye.com",
                avatar: "https://cdn-icons-png.flaticon.com/512/149/149071.png",
                role: "æ™®é€šç”¨æˆ·",
                bio: "ä¸“æ³¨æŸ‘æ©˜ç§æ¤20å¹´",
                farmInfo: {
                    name: "ç‹å¤§ä¼¯ç”Ÿæ€æœå›­",
                    address: "æ±Ÿè¥¿çœèµ£å·å¸‚å¯»ä¹Œå¿",
                    type: "ä¸ªä½“å†œæˆ·"
                }
            },
            flashSale: [
                { id: 101, title: "ç›´æ’­è¯æœ¯é€Ÿæˆï¼š3å°æ—¶å–çˆ†å†œè´§", price: 0.01, originalPrice: 199, sold: 999, img: "https://images.unsplash.com/photo-1478131143081-80f7f84ca84d?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80" },
                { id: 102, title: "çŸ­è§†é¢‘æ‹æ‘„å‰ªè¾‘ï¼šç”°é—´åœ°å¤´ä¹Ÿæ˜¯å¤§ç‰‡", price: 8.88, originalPrice: 299, sold: 1542, img: "https://images.unsplash.com/photo-1516035069371-29a1b244cc32?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80" },
                { id: 103, title: "ç§åŸŸæµé‡è¿è¥ï¼šå¤è´­ç‡æå‡100%", price: 9.90, originalPrice: 399, sold: 888, img: "https://images.unsplash.com/photo-1556761175-5973dc0f32e7?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80" }
            ],
            rankingCourses: [
                { id: 401, title: "2024å†œäº§å“ç›´æ’­å…¨æ¡ˆç­–åˆ’", price: 199, originalPrice: 499, sold: 12000, img: "https://images.unsplash.com/photo-1524178232363-1fb2b075b655?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80" },
                { id: 402, title: "é›¶åŸºç¡€çŸ­è§†é¢‘å¸¦è´§å®æ“", price: 99, originalPrice: 299, sold: 8500, img: "https://images.unsplash.com/photo-1492633423870-43d1cd2775eb?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80" },
                { id: 403, title: "æœæ ‘ç§æ¤ä¸ç—…è™«å®³é˜²æ²»", price: 128, originalPrice: 368, sold: 6200, img: "https://images.unsplash.com/photo-1605000797499-95a51c5269ae?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80" }
            ],
            streamers: [
                { id: 201, name: "å†œå“¥å¤§å£®", title: "å…¨ç½‘ç²‰ä¸500w+", desc: "å•åœºå¸¦è´§ç ´ç™¾ä¸‡ï¼Œæ“…é•¿å¹½é»˜é£ç›´æ’­", img: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80" },
                { id: 202, name: "æœå›­å°å¦¹", title: "æ°´æœå¸¦è´§ä¸€å§", desc: "äº²å’ŒåŠ›æ»¡åˆ†ï¼Œæ•™ä½ å¦‚ä½•å±•ç¤ºæ°´æœç»†èŠ‚", img: "https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80" },
                { id: 203, name: "å±±è´§è€å¼ ", title: "å®è¯šå¸¦è´§äºº", desc: "20å¹´å†œäº§å“ç»éªŒï¼Œæ•™ä½ é€‰å“å®šå“", img: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80" }
            ],
            mallItems: [
                { id: 301, type: 'product', title: "ä¸“ä¸šç›´æ’­è¡¥å…‰ç¯", points: 500, img: "https://images.unsplash.com/photo-1527011046414-4781f1f94f8c?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80", desc: "ä¸“ä¸ºç›´æ’­è®¾è®¡çš„ç¯å½¢è¡¥å…‰ç¯ï¼Œä¸‰è‰²æ¸©è°ƒèŠ‚ã€‚" },
                { id: 302, type: 'product', title: "æ— çº¿é¢†å¤¹éº¦å…‹é£", points: 800, img: "https://images.unsplash.com/photo-1590845947698-8924d7409b56?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80", desc: "é™å™ªæ”¶éŸ³ï¼Œ20ç±³è¿œè·ç¦»ä¼ è¾“ï¼Œæˆ·å¤–ç›´æ’­ç¥å™¨ã€‚" },
                { id: 303, type: 'course', title: "æ‰‹æœºæ‘„å½±æ„å›¾è¯¾", points: 300, img: "https://images.unsplash.com/photo-1516321318423-f06f85e504b3?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80", desc: "30åˆ†é’Ÿå­¦ä¼šé»„é‡‘åˆ†å‰²ã€å¼•å¯¼çº¿æ„å›¾ï¼Œè®©ç…§ç‰‡æ›´æœ‰è´¨æ„Ÿã€‚" }
            ],
            successStories: [
                { name: "æ±Ÿé—¨æ¿€æºæ©˜ä¸š", prev: 35, current: 86, desc: "é€šè¿‡ç›´æ’­å¸¦è´§ï¼Œæ©˜å­æ»é”€å˜è„±é”€" },
                { name: "èµ£å—è„æ©™åˆä½œç¤¾", prev: 20, current: 92, desc: "å…¨å‘˜åŸ¹è®­ï¼Œçº¿ä¸Šé”€é‡ç¿»ä¸‰ç•ª" },
                { name: "å¤§åˆ«å±±èŒ¶å¶é“º", prev: 45, current: 78, desc: "å“ç‰ŒåŒ–è¿è¥ï¼Œå®¢å•ä»·æå‡50%" }
            ],
            history: [
                { title: "2024å†œäº§å“ç”µå•†è¶‹åŠ¿åˆ†æ", date: "2023-10-05" },
                { title: "å¦‚ä½•åˆ©ç”¨AIå†™æ–‡æ¡ˆ", date: "2023-09-28" }
            ],
            community: {
                qa: [
                    { title: "ç›´æ’­é—´æ²¡äººæ°”æ€ä¹ˆåŠï¼Ÿ", replies: 128 },
                    { title: "æ°´æœå¿«é€’åŒ…è£…æ€ä¹ˆçœæˆæœ¬ï¼Ÿ", replies: 56 }
                ],
                live: [
                    { title: "æ­£åœ¨ç›´æ’­ï¼šæœå›­å®åœ°è€ƒå¯Ÿæ•™å­¦", viewer: "1.2w" },
                    { title: "æ™šé—´ç ”è®¨ï¼šæ˜å¹´ç§ä»€ä¹ˆæœ€èµšé’±", viewer: "3k" }
                ],
                posts: [
                    { id: 501, type: 'video', title: "è€å†œç»éªŒï¼šæœæ ‘ä¿®å‰ªä¸‰å¤§è¯¯åŒºï¼Œä½ ä¸­æ‹›äº†å—ï¼Ÿ", author: "èµµå¤§å”", avatar: "https://randomuser.me/api/portraits/men/32.jpg", likes: 328, isLiked: false, content: "å¾ˆå¤šæœå†œåœ¨ä¿®å‰ªæ—¶åªé¡¾ç€å‰ªæï¼Œå´å¿½ç•¥äº†å…‰ç…§å’Œé€šé£ï¼Œå¯¼è‡´æœå®å“è´¨ä¸‹é™ã€‚ä»Šå¤©ç»™å¤§å®¶åˆ†äº«ä¸‰ä¸ªä¿®å‰ªæ—¶çš„å¸¸è§è¯¯åŒºï¼Œå¸®åŠ©å¤§å®¶é¿å‘...", img: "https://images.unsplash.com/photo-1592323642286-519c8d046305?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80" },
                    { id: 502, type: 'bounty', title: "è¯·é—®å„ä½è€å¸ˆï¼Œè¿™ç§å¶å­å‘é»„æ˜¯ä»€ä¹ˆç—…ï¼Ÿæ€¥ï¼", reward: 20, author: "ç‹è€å®", avatar: "https://randomuser.me/api/portraits/men/45.jpg", likes: 5, isLiked: false, content: "ç§äº†ä¸‰å¹´çš„ç ‚ç³–æ©˜ï¼Œæœ€è¿‘å‘ç°å¶ç‰‡å¤§é¢ç§¯å‘é»„ï¼Œç”¨äº†è¯ä¹Ÿä¸è§å¥½ã€‚è¯·é—®è¿™æ˜¯ç¼ºç´ è¿˜æ˜¯é»„é¾™ç—…å‰å…†ï¼Ÿæœ‰æ‚¬èµï¼Œæ±‚ä¸“å®¶è§£ç­”ï¼", img: "https://images.unsplash.com/photo-1518568814500-bf0f8d125f46?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80" },
                    { id: 503, type: 'image', title: "ä»Šå¹´æ”¶æˆä¸é”™ï¼Œä¸ªä¸ªé¥±æ»¡ï¼", author: "æå¤§å§", avatar: "https://randomuser.me/api/portraits/women/44.jpg", likes: 86, isLiked: false, content: "æ„Ÿè°¢äº‘é“¾ä¹¡åœŸçš„åŸ¹è®­ï¼Œå­¦ä¹ äº†ç§‘å­¦æ–½è‚¥å’Œæ§æ°´ï¼Œä»Šå¹´çš„æŒ‚æœç‡æ¯”å»å¹´æé«˜äº†ä¸å°‘ï¼çœ‹è¿™æœå­ï¼Œå¤šæ¼‚äº®ï¼", img: "https://images.unsplash.com/photo-1615485290382-441e4d049cb5?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80" }
                ]
            }
        };

        // App Logic
        const app = {
            state: {
                view: 'home',
                points: 100,
                cart: [],
                purchased: [],
                subTabs: {
                    'courses-points': 'purchased',
                    'community': 'recommend'
                }
            },

            init() {
                this.navigate('home');
                this.startTimer();
            },

            navigate(view, data = null) {
                this.state.view = view;
                
                // Update Nav
                document.querySelectorAll('.nav-btn').forEach(el => {
                    el.classList.remove('nav-active', 'text-green-600');
                    el.classList.add('text-gray-400');
                });
                const activeNav = document.getElementById(`nav-${view}`);
                if(activeNav) {
                    activeNav.classList.add('nav-active', 'text-green-600');
                    activeNav.classList.remove('text-gray-400');
                }

                // Render
                const container = document.getElementById('app-container');
                window.scrollTo(0,0);

                // Simple Router
                if (view === 'home') container.innerHTML = this.renderHome();
                else if (view === 'hot-courses') container.innerHTML = this.renderHotCourses();
                else if (view === 'courses-points') container.innerHTML = this.renderCoursesPoints();
                else if (view === 'community') container.innerHTML = this.renderCommunity();
                else if (view === 'mine') container.innerHTML = this.renderMine();
                else if (view === 'course-detail') container.innerHTML = this.renderCourseDetail(data);
                else if (view === 'streamer-detail') container.innerHTML = this.renderStreamerDetail(data);
                else if (view === 'product-detail') container.innerHTML = this.renderProductDetail(data);
                else if (view === 'farmer-entry') container.innerHTML = this.renderFarmerEntry();
                else if (view === 'hot-ranking') container.innerHTML = this.renderHotRanking();
                else if (view === 'post-detail') container.innerHTML = this.renderPostDetail(data);
                else if (view === 'profile-edit') container.innerHTML = this.renderProfileEdit();
                
                this.updateHeader();
            },

            updateHeader() {
                document.getElementById('header-points').innerText = this.state.points;
                const badge = document.getElementById('cart-badge');
                if(this.state.cart.length > 0) {
                    badge.innerText = this.state.cart.length;
                    badge.classList.remove('hidden');
                } else {
                    badge.classList.add('hidden');
                }
            },

            setSubTab(parent, tab) {
                this.state.subTabs[parent] = tab;
                this.navigate(parent);
            },

            // --- Render Functions ---

            renderHome() {
                return `
                    <!-- Banner -->
                    <div class="bg-white rounded-xl overflow-hidden shadow mb-4 relative">
                        <div class="h-40 bg-gray-800 relative">
                            <img src="https://images.unsplash.com/photo-1625246333195-78d9c38ad449?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80" class="w-full h-full object-cover opacity-70">
                            <div class="absolute top-2 right-2 bg-red-500 text-white text-xs px-2 py-1 rounded flex items-center animate-pulse">
                                <i class="fa-solid fa-circle text-[8px] mr-1"></i> ç›´æ’­ä¸­
                            </div>
                            <div class="absolute bottom-0 left-0 w-full p-3 text-white bg-gradient-to-t from-black/80 to-transparent">
                                <h2 class="text-lg font-bold">åŠ©å†œç›´æ’­é—´</h2>
                                <p class="text-xs opacity-90">ä¼˜è´¨å†œäº§å“ æºå¤´ç›´å‘</p>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions Grid -->
                    <div class="grid grid-cols-2 gap-3 mb-6">
                        <div class="bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-xl shadow-sm flex flex-col items-center justify-center cursor-pointer border border-green-200" onclick="app.navigate('farmer-entry')">
                            <div class="w-12 h-12 bg-green-200 rounded-full flex items-center justify-center mb-2 text-green-700">
                                <i class="fa-solid fa-user-plus text-xl"></i>
                            </div>
                            <h3 class="font-bold text-gray-800">å†œæˆ·å…¥é©»</h3>
                            <p class="text-xs text-gray-500 text-center">ä¸€é”®å¼€é€š å®˜æ–¹æ‰¶æŒ</p>
                        </div>
                        <div class="bg-gradient-to-br from-orange-50 to-orange-100 p-4 rounded-xl shadow-sm flex flex-col items-center justify-center cursor-pointer border border-orange-200" onclick="alert('è·³è½¬åˆ°åŸ¹è®­æŠ¥åè¡¨æ ¼')">
                            <div class="w-12 h-12 bg-orange-200 rounded-full flex items-center justify-center mb-2 text-orange-700">
                                <i class="fa-solid fa-graduation-cap text-xl"></i>
                            </div>
                            <h3 class="font-bold text-gray-800">åŸ¹è®­æŠ¥å</h3>
                            <p class="text-xs text-gray-500 text-center">ç”µå•†è¿è¥ ç§æ¤æŠ€æœ¯</p>
                        </div>
                    </div>

                    <!-- Flash Sale Section -->
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="font-bold text-lg border-l-4 border-green-600 pl-2">ç§’æ€ç²¾å“è¯¾ç¨‹</h3>
                            <div class="text-xs text-gray-500">è·ç»“æŸ <span class="bg-red-500 text-white px-1 rounded timer">02:15:30</span></div>
                        </div>
                        <div class="flex overflow-x-auto gap-3 pb-2 scrollbar-hide">
                            ${db.flashSale.map(c => `
                                <div onclick="app.navigate('course-detail', ${c.id})" class="min-w-[140px] bg-white rounded-lg shadow overflow-hidden">
                                    <img src="${c.img}" class="w-full h-28 object-cover">
                                    <div class="p-2">
                                        <div class="font-medium text-sm truncate">${c.title}</div>
                                        <div class="text-xs text-gray-400 mt-1">å·²æŠ¢ <span class="text-orange-500">âœ–ï¸${c.sold}</span></div>
                                        <div class="flex items-end justify-between mt-1">
                                            <span class="text-red-600 font-bold">Â¥${c.price}</span>
                                            <span class="text-xs text-gray-300 line-through">Â¥${c.originalPrice}</span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Popular Streamers -->
                    <div class="mb-6">
                        <h3 class="font-bold text-lg border-l-4 border-green-600 pl-2 mb-3">äººæ°”ä¸»æ’­</h3>
                        <div class="grid grid-cols-3 gap-3">
                            ${db.streamers.map(s => `
                                <div onclick="app.navigate('streamer-detail', ${s.id})" class="bg-white rounded-lg shadow p-2 flex flex-col items-center text-center cursor-pointer relative group">
                                    <img src="${s.img}" class="w-16 h-16 rounded-full border-2 border-green-100 mb-2 object-cover group-hover:scale-105 transition">
                                    <div class="text-xs font-bold truncate w-full">${s.name}</div>
                                    <div class="text-[10px] text-orange-500 mt-1">ğŸ”¥ äººæ°”ç«çˆ†</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            },

            renderHotCourses() {
                return `
                    <!-- Hot Ranking Teaser -->
                    <div class="bg-gradient-to-r from-green-50 to-green-100 p-4 rounded-xl mb-6 flex items-center justify-between shadow-md cursor-pointer" onclick="app.navigate('hot-ranking')">
                        <div>
                            <h2 class="text-xl font-bold text-green-800">çƒ­é”€è¯¾ç¨‹æ¦œ</h2>
                            <p class="text-xs text-green-600 mt-1">æŸ¥çœ‹ TOP 50 æ¦œå• <i class="fa-solid fa-arrow-right text-[10px]"></i></p>
                        </div>
                        <i class="fa-solid fa-trophy text-4xl text-yellow-500 drop-shadow-sm"></i>
                    </div>

                    <!-- Flash Sale Grid -->
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="font-bold text-gray-800 flex items-center gap-2"><i class="fa-solid fa-stopwatch text-red-500"></i> é™æ—¶ç§’æ€</h3>
                            <span class="text-xs bg-red-100 text-red-500 px-2 py-1 rounded-full timer">02:15:30</span>
                        </div>
                        <div class="space-y-3">
                            ${db.flashSale.map(c => `
                                <div onclick="app.navigate('course-detail', ${c.id})" class="bg-white rounded-lg shadow p-3 flex gap-3">
                                    <img src="${c.img}" class="w-24 h-24 rounded object-cover">
                                    <div class="flex-1 flex flex-col justify-between">
                                        <div>
                                            <h4 class="font-bold text-sm line-clamp-2">${c.title}</h4>
                                            <div class="text-xs text-gray-500 mt-1">å·²å”® <span class="text-orange-500">âœ–ï¸${c.sold}</span></div>
                                        </div>
                                        <div class="flex justify-between items-end">
                                            <div>
                                                <span class="text-red-600 font-bold text-lg">Â¥${c.price}</span>
                                                <span class="text-xs text-gray-400 line-through ml-1">Â¥${c.originalPrice}</span>
                                            </div>
                                            ${this.state.purchased.includes(c.id) ? 
                                                '<span class="text-green-600 text-xs font-bold"><i class="fa-solid fa-check"></i> å·²è´­</span>' : 
                                                '<button class="bg-green-600 text-white text-xs px-3 py-1.5 rounded-full">æŠ¢è´­</button>'}
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Points Mall Preview -->
                    <div class="mb-20">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="font-bold text-gray-800">ç§¯åˆ†å•†åŸ</h3>
                            <button onclick="app.navigate('courses-points')" class="text-xs text-gray-500">æŸ¥çœ‹æ›´å¤š <i class="fa-solid fa-chevron-right"></i></button>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            ${db.mallItems.slice(0,2).map(item => `
                                <div onclick="app.navigate('product-detail', ${item.id})" class="bg-white rounded-lg shadow p-2">
                                    <img src="${item.img}" class="w-full h-24 object-cover rounded mb-2">
                                    <div class="font-medium text-xs truncate">${item.title}</div>
                                    <div class="text-orange-500 text-xs font-bold mt-1"><i class="fa-solid fa-coins"></i> ${item.points} ç§¯åˆ†</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            },

            renderCoursesPoints() {
                const tab = this.state.subTabs['courses-points'];
                return `
                    <!-- Points Header -->
                    <div class="bg-gradient-to-r from-green-500 to-teal-600 rounded-xl p-5 text-white mb-4 shadow-lg">
                        <div class="text-sm opacity-80">æˆ‘çš„ç§¯åˆ†</div>
                        <div class="text-3xl font-bold mt-1">${this.state.points}</div>
                        <div class="mt-3 flex gap-2">
                            <button class="bg-white/20 text-xs px-3 py-1 rounded-full">ç§¯åˆ†è®°å½•</button>
                            <button class="bg-white text-green-600 font-bold text-xs px-3 py-1 rounded-full">å»å…‘æ¢</button>
                        </div>
                    </div>

                    <!-- Sub Tabs -->
                    <div class="flex border-b border-gray-200 mb-4 bg-white rounded-t-lg">
                        <div onclick="app.setSubTab('courses-points', 'purchased')" class="flex-1 text-center py-3 text-sm font-medium cursor-pointer ${tab === 'purchased' ? 'text-green-600 border-b-2 border-green-600' : 'text-gray-500'}">å·²è´­è¯¾ç¨‹</div>
                        <div onclick="app.setSubTab('courses-points', 'managed')" class="flex-1 text-center py-3 text-sm font-medium cursor-pointer ${tab === 'managed' ? 'text-green-600 border-b-2 border-green-600' : 'text-gray-500'}">è´¦å·æ‰˜ç®¡</div>
                        <div onclick="app.setSubTab('courses-points', 'mall')" class="flex-1 text-center py-3 text-sm font-medium cursor-pointer ${tab === 'mall' ? 'text-green-600 border-b-2 border-green-600' : 'text-gray-500'}">ç§¯åˆ†å•†åŸ</div>
                    </div>

                    <!-- Content -->
                    <div class="mb-20">
                        ${this.renderCoursesPointsContent(tab)}
                    </div>
                `;
            },

            renderCoursesPointsContent(tab) {
                if (tab === 'purchased') {
                    const purchasedItems = [...db.flashSale, ...db.rankingCourses].filter(c => this.state.purchased.includes(c.id));
                    
                    let html = '';
                    if(purchasedItems.length === 0) {
                        html = `<div class="text-center text-gray-400 py-8 bg-white rounded-lg shadow-sm">æš‚æ— å·²è´­è¯¾ç¨‹<br><span class="text-xs">å¿«å»çƒ­é”€è¯¾ç¨‹é€‰è´­å§</span></div>`;
                    } else {
                        html = purchasedItems.map(c => `
                            <div class="bg-white p-3 rounded-lg shadow mb-3 flex gap-3">
                                <img src="${c.img}" class="w-20 h-20 rounded object-cover">
                                <div class="flex-1 flex flex-col justify-between">
                                    <h4 class="font-bold text-sm">${c.title}</h4>
                                    <button class="bg-green-600 text-white text-xs py-1.5 rounded text-center mt-2">ç«‹å³è§‚çœ‹</button>
                                </div>
                            </div>
                        `).join('');
                    }

                    html += `
                        <div class="mt-6">
                            <h3 class="font-bold text-gray-700 mb-3 pl-2 border-l-4 border-gray-400">å†å²è§‚çœ‹</h3>
                            <div class="space-y-2">
                                ${db.history.map(h => `
                                    <div class="bg-white p-3 rounded shadow-sm flex justify-between items-center">
                                        <div class="text-sm text-gray-800">${h.title}</div>
                                        <div class="text-xs text-gray-400">${h.date}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    return html;
                } else if (tab === 'managed') {
                    return `
                        <div class="bg-white p-6 rounded-xl shadow">
                             <div class="text-center mb-4">
                                <i class="fa-solid fa-user-tie text-5xl text-blue-500 mb-2"></i>
                                <h2 class="text-lg font-bold">ä¸“ä¸šè´¦å·æ‰˜ç®¡</h2>
                                <p class="text-xs text-gray-500">å®˜æ–¹å›¢é˜Ÿä¸ºæ‚¨æä¾›ä¸€ç«™å¼ä»£è¿è¥æœåŠ¡</p>
                            </div>
                            <form onsubmit="event.preventDefault(); alert('ç”³è¯·å·²æäº¤ï¼Œå·¥ä½œäººå‘˜å°†åœ¨24å°æ—¶å†…è”ç³»æ‚¨');">
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-xs font-bold text-gray-700 mb-1">å†œæˆ·/åˆä½œç¤¾åç§°</label>
                                        <input type="text" class="w-full border border-gray-300 rounded p-2 text-sm focus:outline-none focus:border-green-500" required>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-gray-700 mb-1">ä¸»è¥äº§å“</label>
                                        <input type="text" class="w-full border border-gray-300 rounded p-2 text-sm focus:outline-none focus:border-green-500" required>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-gray-700 mb-1">è”ç³»ç”µè¯</label>
                                        <input type="tel" class="w-full border border-gray-300 rounded p-2 text-sm focus:outline-none focus:border-green-500" required>
                                    </div>
                                    <button type="submit" class="w-full bg-green-600 text-white py-2 rounded-lg font-bold mt-2">æäº¤ç”³è¯·</button>
                                </div>
                            </form>
                        </div>
                    `;
                } else if (tab === 'mall') {
                    return `
                        <div class="grid grid-cols-2 gap-3">
                            ${db.mallItems.map(item => `
                                <div onclick="app.navigate('product-detail', ${item.id})" class="bg-white rounded-lg shadow p-3 cursor-pointer">
                                    <img src="${item.img}" class="w-full h-28 object-cover rounded mb-2">
                                    <div class="font-medium text-sm truncate">${item.title}</div>
                                    <div class="flex justify-between items-center mt-2">
                                        <div class="text-orange-500 font-bold text-xs"><i class="fa-solid fa-coins"></i> ${item.points}</div>
                                        <button class="bg-orange-100 text-orange-600 text-xs px-2 py-1 rounded">å…‘æ¢</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
            },

            renderCommunity() {
                const tab = this.state.subTabs['community'];
                return `
                    <div class="bg-white p-2 rounded-xl shadow-sm mb-4 flex">
                        <button onclick="app.setSubTab('community', 'recommend')" class="flex-1 py-2 text-sm font-bold ${tab === 'recommend' ? 'text-green-600 border-b-2 border-green-600' : 'text-gray-500'}">æ¨è</button>
                        <button onclick="app.setSubTab('community', 'qa')" class="flex-1 py-2 text-sm font-bold ${tab === 'qa' ? 'text-green-600 border-b-2 border-green-600' : 'text-gray-500'}">é—®ç­”</button>
                        <button onclick="app.setSubTab('community', 'live')" class="flex-1 py-2 text-sm font-bold ${tab === 'live' ? 'text-green-600 border-b-2 border-green-600' : 'text-gray-500'}">ç›´æ’­</button>
                    </div>

                    <div class="space-y-3 pb-20">
                        ${this.renderCommunityContent(tab)}
                    </div>
                `;
            },

            renderCommunityContent(tab) {
                 if (tab === 'recommend') {
                    // Masonry-like feed for posts
                    return `
                        <div class="columns-2 gap-3 space-y-3">
                            ${db.community.posts.map(post => `
                                <div onclick="app.navigate('post-detail', ${post.id})" class="break-inside-avoid bg-white rounded-lg overflow-hidden shadow cursor-pointer">
                                    <div class="relative">
                                        <img src="${post.img}" class="w-full h-auto object-cover">
                                        ${post.type === 'video' ? '<div class="absolute inset-0 flex items-center justify-center bg-black/20"><i class="fa-solid fa-play text-white text-2xl"></i></div>' : ''}
                                        ${post.type === 'bounty' ? `<div class="absolute top-2 right-2 bg-orange-500 text-white text-[10px] px-1.5 py-0.5 rounded">Â¥${post.reward}æ‚¬èµ</div>` : ''}
                                    </div>
                                    <div class="p-2">
                                        <h4 class="text-sm font-bold line-clamp-2 mb-1">${post.title}</h4>
                                        <div class="flex items-center justify-between text-xs text-gray-500">
                                            <div class="flex items-center">
                                                <img src="${post.avatar}" class="w-4 h-4 rounded-full mr-1">
                                                <span class="truncate max-w-[60px]">${post.author}</span>
                                            </div>
                                            <div class="flex items-center">
                                                <i class="${post.isLiked ? 'fa-solid text-red-500' : 'fa-regular'} fa-heart mr-1"></i> ${post.likes}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else if (tab === 'qa') {
                    return db.community.qa.map(q => `
                        <div class="bg-white p-4 rounded-lg shadow">
                             <div class="flex items-start gap-2">
                                <span class="bg-green-100 text-green-700 text-xs px-1.5 py-0.5 rounded font-bold mt-0.5">é—®</span>
                                <h4 class="font-bold text-sm text-gray-800">${q.title}</h4>
                            </div>
                            <div class="mt-2 text-xs text-gray-500 text-right">${q.replies} ä¸ªå›ç­”</div>
                        </div>
                    `).join('');
                } else if (tab === 'live') {
                    return db.community.live.map(l => `
                        <div class="bg-white p-3 rounded-lg shadow flex items-center gap-3">
                            <div class="relative w-20 h-14 rounded overflow-hidden bg-gray-800">
                                    <div class="absolute inset-0 flex items-center justify-center"><i class="fa-solid fa-play text-white opacity-80"></i></div>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-bold text-sm">${l.title}</h4>
                                <div class="text-xs text-red-500 mt-1 flex items-center gap-1"><span class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></span> ${l.viewer} åœ¨çœ‹</div>
                            </div>
                        </div>
                    `).join('');
                }
            },

            renderPostDetail(id) {
                const post = db.community.posts.find(p => p.id == id);
                return `
                    <div class="bg-white min-h-screen pb-16">
                        <div class="sticky top-0 z-20 bg-white border-b border-gray-100 p-3 flex items-center">
                            <i class="fa-solid fa-arrow-left text-xl cursor-pointer mr-3" onclick="app.navigate('community')"></i>
                            <img src="${post.avatar}" class="w-8 h-8 rounded-full mr-2">
                            <span class="font-bold text-sm">${post.author}</span>
                            <button class="ml-auto bg-red-500 text-white text-xs px-3 py-1 rounded-full">å…³æ³¨</button>
                        </div>
                        
                        <img src="${post.img}" class="w-full h-auto object-cover">
                        
                        <div class="p-4">
                            <h1 class="text-lg font-bold mb-3">${post.title}</h1>
                            <p class="text-sm text-gray-700 leading-relaxed mb-4">${post.content}</p>
                            <div class="text-xs text-gray-400 mb-4">å‘å¸ƒäº 2å°æ—¶å‰</div>
                            
                            <div class="border-t border-gray-100 pt-4">
                                <h3 class="font-bold text-sm mb-3">è¯„è®º (3)</h3>
                                <div class="space-y-3">
                                    <div class="flex gap-2">
                                        <img src="https://randomuser.me/api/portraits/women/12.jpg" class="w-8 h-8 rounded-full">
                                        <div>
                                            <div class="text-xs text-gray-500 font-bold">å¼ å¤§å¦ˆ</div>
                                            <div class="text-sm text-gray-800">è¿™æ–¹æ³•çœŸä¸é”™ï¼Œæˆ‘ä¹Ÿè¯•è¯•ï¼</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="fixed bottom-0 w-full bg-white border-t border-gray-200 p-3 flex items-center justify-around z-30">
                            <div class="flex items-center gap-1 text-gray-600" onclick="this.querySelector('i').classList.toggle('fa-solid'); this.querySelector('i').classList.toggle('text-red-500'); this.querySelector('i').classList.add('like-anim')">
                                <i class="fa-regular fa-heart text-xl"></i> <span class="text-xs">ç‚¹èµ</span>
                            </div>
                            <div class="flex items-center gap-1 text-gray-600">
                                <i class="fa-regular fa-star text-xl"></i> <span class="text-xs">æ”¶è—</span>
                            </div>
                            <div class="flex items-center gap-1 text-gray-600">
                                <i class="fa-regular fa-comment text-xl"></i> <span class="text-xs">è¯„è®º</span>
                            </div>
                        </div>
                    </div>
                `;
            },

            renderFarmerEntry() {
                return `
                    <div class="bg-white min-h-screen p-4">
                        <div class="flex items-center mb-6">
                            <i class="fa-solid fa-arrow-left text-xl cursor-pointer mr-3" onclick="app.navigate('home')"></i>
                            <h1 class="text-lg font-bold">å†œæˆ·å…¥é©»é€šé“</h1>
                        </div>
                        <form onsubmit="event.preventDefault(); alert('å…¥é©»ç”³è¯·å·²æäº¤ï¼å·¥ä½œäººå‘˜å®¡æ ¸é€šè¿‡åå°†çŸ­ä¿¡é€šçŸ¥ã€‚'); app.navigate('home');">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-xs text-gray-500 mb-1">å§“å/è´Ÿè´£äºº</label>
                                    <input type="text" class="w-full border border-gray-300 rounded p-2 text-sm" placeholder="è¯·è¾“å…¥çœŸå®å§“å" required>
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-500 mb-1">è”ç³»ç”µè¯</label>
                                    <input type="tel" class="w-full border border-gray-300 rounded p-2 text-sm" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" required>
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-500 mb-1">å†œåœº/åŸºåœ°ä½ç½®</label>
                                    <input type="text" class="w-full border border-gray-300 rounded p-2 text-sm" placeholder="çœ/å¸‚/åŒº/å…·ä½“åœ°å€" required>
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-500 mb-1">å…¥é©»ç±»å‹</label>
                                    <select class="w-full border border-gray-300 rounded p-2 text-sm">
                                        <option>ä¸ªä½“å†œæˆ·</option>
                                        <option>å†œä¸šåˆä½œç¤¾</option>
                                        <option>å®¶åº­å†œåœº</option>
                                        <option>å†œä¸šä¼ä¸š</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-500 mb-1">ä¸»è¥äº§å“ç±»å‹</label>
                                    <select class="w-full border border-gray-300 rounded p-2 text-sm">
                                        <option>æ°´æœç”Ÿé²œç±»</option>
                                        <option>æœè„¯ç±»</option>
                                        <option>å‰¯é£Ÿå“åŠ å·¥ç±»</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-500 mb-1">ç”¨æˆ·ä¿¡æ¯è¡¥å……</label>
                                    <textarea class="w-full border border-gray-300 rounded p-2 text-sm" rows="3" placeholder="ç®€è¦ä»‹ç»ç§æ¤è§„æ¨¡ã€ç‰¹è‰²äº§å“ç­‰ä¿¡æ¯..."></textarea>
                                </div>
                                <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-lg font-bold shadow-md mt-4">ç«‹å³æäº¤ç”³è¯·</button>
                            </div>
                        </form>
                    </div>
                `;
            },

            renderHotRanking() {
                return `
                    <div class="bg-green-50 min-h-screen">
                         <div class="bg-green-600 p-4 pb-12 text-white relative">
                            <i class="fa-solid fa-arrow-left absolute top-4 left-4 text-xl cursor-pointer" onclick="app.navigate('hot-courses')"></i>
                            <div class="text-center">
                                <h1 class="text-xl font-bold">çƒ­é”€è¯¾ç¨‹æ’è¡Œæ¦œ</h1>
                                <p class="text-xs opacity-80 mt-1">å®æ—¶æ›´æ–° â€¢ é”€é‡ä¸ºç‹</p>
                            </div>
                        </div>
                        <div class="-mt-8 px-4 space-y-3 pb-20">
                            ${db.rankingCourses.map((c, index) => `
                                <div onclick="app.navigate('course-detail', ${c.id})" class="bg-white rounded-lg shadow p-3 flex gap-3 items-center">
                                    <div class="w-8 text-center font-bold text-xl italic ${index === 0 ? 'text-red-500' : (index === 1 ? 'text-orange-500' : (index === 2 ? 'text-yellow-500' : 'text-gray-400'))}">${index + 1}</div>
                                    <img src="${c.img}" class="w-20 h-20 rounded object-cover">
                                    <div class="flex-1">
                                        <h4 class="font-bold text-sm">${c.title}</h4>
                                        <div class="text-xs text-gray-500 mt-1">å·²å”® <span class="text-orange-500">${c.sold}</span> å¥—</div>
                                        <div class="text-red-600 font-bold mt-1">Â¥${c.price}</div>
                                    </div>
                                    <button class="bg-green-100 text-green-600 text-xs px-3 py-1 rounded-full">å»çœ‹çœ‹</button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            },

            renderStreamerDetail(id) {
                const s = db.streamers.find(x => x.id == id) || db.streamers[0];
                const sortedStories = [...db.successStories].sort((a, b) => (b.current - b.prev) - (a.current - a.prev));

                return `
                    <div class="bg-black text-white relative">
                        <div class="absolute top-4 left-4 z-10 flex items-center gap-2">
                            <i onclick="app.navigate('hot-courses')" class="fa-solid fa-arrow-left text-xl cursor-pointer shadow-sm"></i>
                            <img src="${s.img}" class="w-8 h-8 rounded-full border border-white">
                            <span class="font-bold text-sm">${s.name}</span>
                        </div>
                        <div class="h-64 flex items-center justify-center bg-gray-900 relative overflow-hidden">
                            <img src="${s.img}" class="absolute inset-0 w-full h-full object-cover opacity-50">
                            <div class="z-10 text-center">
                                <div class="text-4xl mb-2"><i class="fa-solid fa-play-circle opacity-80"></i></div>
                                <div class="text-sm font-bold">ç›´æ’­ä¸­...</div>
                            </div>
                        </div>
                    </div>

                    <div class="p-4 bg-white -mt-4 relative rounded-t-xl z-10">
                        <h2 class="font-bold text-lg mb-1">${s.title}</h2>
                        <p class="text-gray-500 text-xs mb-4">${s.desc}</p>

                        <h3 class="font-bold text-sm mb-3 border-l-4 border-green-600 pl-2">æ¨èç›´æ’­è¯¾ç¨‹</h3>
                        <div class="flex gap-3 overflow-x-auto pb-2 mb-6">
                            ${db.flashSale.slice(0, 2).map(c => `
                                <div onclick="app.navigate('course-detail', ${c.id})" class="min-w-[120px] bg-gray-50 rounded p-2 border border-gray-100 cursor-pointer">
                                    <img src="${c.img}" class="w-full h-16 object-cover rounded mb-2">
                                    <div class="text-xs font-bold truncate">${c.title}</div>
                                    <div class="text-red-600 font-bold text-xs mt-1">Â¥${c.price}</div>
                                </div>
                            `).join('')}
                        </div>

                        <h3 class="font-bold text-sm mb-3 border-l-4 border-green-600 pl-2">åˆä½œè¿è¥æˆåŠŸæ¡ˆä¾‹</h3>
                        <div class="space-y-3 mb-20">
                            ${sortedStories.map((st, idx) => `
                                <div class="bg-white border border-gray-100 rounded shadow-sm p-3">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="font-bold text-sm flex items-center gap-2">
                                            <span class="bg-orange-100 text-orange-600 px-1.5 py-0.5 rounded text-xs">${idx + 1}</span>
                                            ${st.name}
                                        </div>
                                        <div class="text-green-600 font-bold text-xs"><i class="fa-solid fa-arrow-trend-up"></i> å¢é•¿ ${(st.current - st.prev)}%</div>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-1.5 mb-2">
                                        <div class="bg-green-500 h-1.5 rounded-full" style="width: ${st.current}%"></div>
                                    </div>
                                    <div class="text-xs text-gray-500 flex justify-between">
                                        <span>å‰: ${st.prev}%</span>
                                        <span>å: ${st.current}%</span>
                                    </div>
                                    <div class="text-xs text-gray-400 mt-1 bg-gray-50 p-1 rounded">${st.desc}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            },

            renderCourseDetail(id) {
                // Find in both lists
                const c = db.flashSale.find(x => x.id == id) || db.rankingCourses.find(x => x.id == id);
                const isBought = this.state.purchased.includes(id);

                return `
                    <div class="relative">
                        <div class="absolute top-4 left-4 z-20 bg-black/30 rounded-full p-1.5 px-3 text-white cursor-pointer" onclick="window.history.length > 1 ? window.history.back() : app.navigate('home')">
                            <i class="fa-solid fa-arrow-left"></i>
                        </div>
                        <img src="${c.img}" class="w-full h-64 object-cover">
                        
                        <div class="p-4 bg-white rounded-t-xl -mt-4 relative z-10 min-h-screen">
                            <div class="flex justify-between items-start">
                                <h1 class="text-xl font-bold text-gray-800 mb-2 w-3/4">${c.title}</h1>
                                ${isBought ? '<div class="text-green-600 flex flex-col items-center check-anim"><i class="fa-solid fa-circle-check text-2xl"></i><span class="text-[10px] font-bold">å·²è´­ä¹°</span></div>' : ''}
                            </div>

                            <div class="flex items-end gap-2 mb-4">
                                <span class="text-3xl font-bold text-red-600">Â¥${c.price}</span>
                                <span class="text-gray-400 line-through text-sm">Â¥${c.originalPrice}</span>
                            </div>

                            <!-- Mock Description -->
                            <div class="bg-gray-50 p-3 rounded-lg mb-4 flex justify-between items-center">
                                <div>
                                    <div class="text-xs text-gray-500 mb-1">è´­ä¹°å¯å¾—</div>
                                    <div class="text-orange-500 font-bold text-sm"><i class="fa-solid fa-coins"></i> ${Math.floor(c.price * 10)} ç§¯åˆ†</div>
                                </div>
                                <div class="text-xs text-gray-400 border-l pl-3">
                                    <div><i class="fa-solid fa-check-circle text-green-500"></i> éšæ—¶å›æ”¾</div>
                                    <div><i class="fa-solid fa-check-circle text-green-500"></i> ä¸“å®¶ç­”ç–‘</div>
                                </div>
                            </div>

                            <h3 class="font-bold text-lg mb-2 border-l-4 border-green-600 pl-2">è¯¾ç¨‹è¯¦æƒ…</h3>
                            <div class="text-sm text-gray-600 leading-relaxed space-y-4 mb-20">
                                <div>
                                    <h4 class="font-bold text-gray-800 mb-1">1. è¯¾ç¨‹å¤§çº²</h4>
                                    <p>æœ¬è¯¾ç¨‹ç”±ä¸€çº¿åŠ©å†œä¸»æ’­äº²è‡ªæˆè¯¾ï¼Œå†…å®¹æ¶µç›–ç›´æ’­é—´æ­å»ºã€äº§å“é€‰å“ã€è¯æœ¯æ¼”ç»ƒç­‰æ ¸å¿ƒç¯èŠ‚ã€‚ä»0åˆ°1æ•™ä½ å¦‚ä½•æ‰“é€ é«˜äººæ°”åŠ©å†œç›´æ’­é—´ã€‚</p>
                                </div>
                                
                                <div class="rounded-lg overflow-hidden my-2 shadow-sm">
                                    <img src="https://images.unsplash.com/photo-1595975604023-01c813699703?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" class="w-full h-40 object-cover">
                                    <div class="bg-gray-50 p-1.5 text-xs text-center text-gray-500 italic">å®åœ°æ•™å­¦ï¼šç”°é—´åœ°å¤´ç›´æ’­å®æ“</div>
                                </div>

                                <div>
                                    <h4 class="font-bold text-gray-800 mb-1">2. é€‚åˆäººç¾¤</h4>
                                    <ul class="list-disc list-inside pl-1 space-y-1">
                                        <li>è¿”ä¹¡åˆ›ä¸šé’å¹´</li>
                                        <li>å†œä¸šç§æ¤å¤§æˆ·/åˆä½œç¤¾è´Ÿè´£äºº</li>
                                        <li>æƒ³è¦è½¬å‹ç”µå•†çš„æ–°å†œäºº</li>
                                    </ul>
                                </div>

                                <div class="rounded-lg overflow-hidden my-2 shadow-sm">
                                    <img src="https://images.unsplash.com/photo-1556740758-90de374c12ad?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" class="w-full h-40 object-cover">
                                    <div class="bg-gray-50 p-1.5 text-xs text-center text-gray-500 italic">å­¦å‘˜é£é‡‡ï¼šä¸€å¯¹ä¸€æŒ‡å¯¼åœºæ™¯</div>
                                </div>

                                <p class="bg-green-50 p-3 rounded text-green-800 text-xs border border-green-100">
                                    <i class="fa-solid fa-circle-info"></i> è´­ä¹°åè¯·å…³æ³¨å…¬ä¼—å·é¢†å–é…å¥—ç”µå­æ•™æã€‚
                                </p>
                            </div>
                        </div>

                        <!-- Bottom Bar -->
                        <div class="fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 p-3 flex gap-3 z-50">
                            <div class="flex items-center gap-4 px-2">
                                <div class="flex flex-col items-center text-xs text-gray-500">
                                    <i class="fa-solid fa-store text-lg"></i> åº—é“º
                                </div>
                                <div class="flex flex-col items-center text-xs text-gray-500 relative" onclick="alert('Cart Open')">
                                    <i class="fa-solid fa-cart-shopping text-lg"></i> 
                                    <span class="absolute -top-1 -right-1 bg-red-500 w-2 h-2 rounded-full ${this.state.cart.length ? '' : 'hidden'}"></span>
                                    è´­ç‰©è½¦
                                </div>
                            </div>
                            ${isBought ? 
                                `<button class="flex-1 bg-gray-300 text-gray-600 rounded-full font-bold" disabled>å·²è´­ä¹°</button>` :
                                `<button onclick="app.addToCart(${c.id})" class="flex-1 bg-orange-400 text-white rounded-l-full font-bold">åŠ å…¥è´­ç‰©è½¦</button>
                                 <button onclick="app.buy(${c.id}, ${c.price})" class="flex-1 bg-red-600 text-white rounded-r-full font-bold">ç«‹å³è´­ä¹°</button>`
                            }
                        </div>
                    </div>
                `;
            },

            renderProductDetail(id) {
                const item = db.mallItems.find(x => x.id == id);
                return `
                    <div class="bg-white min-h-screen relative">
                         <div class="absolute top-4 left-4 z-20 bg-black/30 rounded-full p-1.5 px-3 text-white cursor-pointer" onclick="app.navigate('courses-points')">
                            <i class="fa-solid fa-arrow-left"></i>
                        </div>
                        <img src="${item.img}" class="w-full h-64 object-cover">
                        <div class="p-5">
                            <h1 class="text-xl font-bold mb-2">${item.title}</h1>
                            <div class="text-orange-500 font-bold text-xl mb-4"><i class="fa-solid fa-coins"></i> ${item.points} ç§¯åˆ†</div>
                            <div class="bg-gray-50 p-4 rounded text-sm text-gray-600 mb-6">
                                <h3 class="font-bold mb-2">${item.type === 'course' ? 'è¯¾ç¨‹ç®€ä»‹' : 'å•†å“è¯¦æƒ…'}</h3>
                                <p>${item.desc || 'æš‚æ— æè¿°'}</p>
                                ${item.type === 'course' ? '<p class="mt-2 text-xs text-gray-500">å…‘æ¢åå¯ç›´æ¥åœ¨â€œå·²è´­è¯¾ç¨‹â€ä¸­è§‚çœ‹ã€‚</p>' : '<p class="mt-2 text-xs text-gray-500">å…‘æ¢åå°†äº3ä¸ªå·¥ä½œæ—¥å†…å‘è´§ã€‚</p>'}
                            </div>
                            <button class="w-full bg-green-600 text-white font-bold py-3 rounded-full shadow" onclick="alert('ç§¯åˆ†ä¸è¶³æˆ–æ¨¡æ‹Ÿå…‘æ¢æˆåŠŸ')">ç«‹å³å…‘æ¢</button>
                        </div>
                    </div>
                `;
            },

            renderMine() {
                const u = db.user;
                return `
                    <div class="bg-white rounded-xl p-6 shadow-sm mb-4">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-gray-200 rounded-full overflow-hidden">
                                <img src="${u.avatar}" class="w-full h-full object-cover">
                            </div>
                            <div class="flex-1">
                                <div class="font-bold text-lg flex items-center gap-2">
                                    ${u.name} 
                                    <span class="bg-green-100 text-green-700 text-[10px] px-1 rounded border border-green-200">${u.role}</span>
                                </div>
                                <div class="text-xs text-gray-500 mt-1">ç§¯åˆ†: ${this.state.points}</div>
                                <div class="text-xs text-gray-400 mt-1 truncate">${u.bio}</div>
                            </div>
                            <button onclick="app.navigate('profile-edit')" class="text-gray-400 hover:text-green-600"><i class="fa-solid fa-pen-to-square text-xl"></i></button>
                        </div>
                    </div>
                     <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                        <div class="p-4 border-b border-gray-100 flex justify-between items-center">
                            <span>æˆ‘çš„è®¢å•</span> <i class="fa-solid fa-chevron-right text-xs text-gray-300"></i>
                        </div>
                        <div class="p-4 border-b border-gray-100 flex justify-between items-center">
                             <span>æˆ‘çš„è¯¾ç¨‹</span> <i class="fa-solid fa-chevron-right text-xs text-gray-300"></i>
                        </div>
                        <div class="p-4 border-b border-gray-100 flex justify-between items-center">
                             <span>è”ç³»å®¢æœ</span> <i class="fa-solid fa-chevron-right text-xs text-gray-300"></i>
                        </div>
                    </div>
                `;
            },

            renderProfileEdit() {
                const u = db.user;
                return `
                    <div class="bg-white min-h-screen p-4 pb-20">
                        <div class="flex items-center mb-6">
                            <i class="fa-solid fa-arrow-left text-xl cursor-pointer mr-3" onclick="app.navigate('mine')"></i>
                            <h1 class="text-lg font-bold">ç¼–è¾‘ä¸ªäººèµ„æ–™</h1>
                        </div>
                        
                        <!-- Avatar -->
                        <div class="flex justify-center mb-6">
                            <div class="relative">
                                <img src="${u.avatar}" class="w-24 h-24 rounded-full border-4 border-green-50 shadow-lg object-cover">
                                <div class="absolute bottom-0 right-0 bg-green-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm border-2 border-white shadow"><i class="fa-solid fa-camera"></i></div>
                            </div>
                        </div>

                        <div class="space-y-4">
                            <!-- Basic Info -->
                            <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                                <h3 class="text-sm font-bold text-green-800 mb-3 border-b border-gray-100 pb-2">åŸºæœ¬ä¿¡æ¯</h3>
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-xs text-gray-500 mb-1">æ˜µç§°</label>
                                        <input type="text" id="edit-name" class="w-full border border-gray-300 rounded p-2 text-sm focus:border-green-500 outline-none" value="${u.name}">
                                    </div>
                                    <div>
                                        <label class="block text-xs text-gray-500 mb-1">ä¸ªæ€§ç­¾å</label>
                                        <input type="text" id="edit-bio" class="w-full border border-gray-300 rounded p-2 text-sm focus:border-green-500 outline-none" value="${u.bio}">
                                    </div>
                                </div>
                            </div>

                            <!-- Farmer Info -->
                            <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                                <h3 class="text-sm font-bold text-green-800 mb-3 border-b border-gray-100 pb-2">å†œæˆ·å…¥é©»ä¿¡æ¯</h3>
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-xs text-gray-500 mb-1">å†œåœº/åº—é“ºåç§°</label>
                                        <input type="text" id="edit-farm-name" class="w-full border border-gray-300 rounded p-2 text-sm focus:border-green-500 outline-none" value="${u.farmInfo?.name || ''}" placeholder="æœªå¡«å†™">
                                    </div>
                                    <div>
                                        <label class="block text-xs text-gray-500 mb-1">ç»è¥ä¸»ä½“ç±»å‹</label>
                                        <select id="edit-farm-type" class="w-full border border-gray-300 rounded p-2 text-sm focus:border-green-500 outline-none bg-white">
                                            <option value="ä¸ªä½“å†œæˆ·" ${u.farmInfo?.type === 'ä¸ªä½“å†œæˆ·' ? 'selected' : ''}>ä¸ªä½“å†œæˆ·</option>
                                            <option value="å†œä¸šåˆä½œç¤¾" ${u.farmInfo?.type === 'å†œä¸šåˆä½œç¤¾' ? 'selected' : ''}>å†œä¸šåˆä½œç¤¾</option>
                                            <option value="å®¶åº­å†œåœº" ${u.farmInfo?.type === 'å®¶åº­å†œåœº' ? 'selected' : ''}>å®¶åº­å†œåœº</option>
                                            <option value="å†œä¸šä¼ä¸š" ${u.farmInfo?.type === 'å†œä¸šä¼ä¸š' ? 'selected' : ''}>å†œä¸šä¼ä¸š</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs text-gray-500 mb-1">æ‰€åœ¨åœ°åŒº</label>
                                        <input type="text" id="edit-farm-addr" class="w-full border border-gray-300 rounded p-2 text-sm focus:border-green-500 outline-none" value="${u.farmInfo?.address || ''}" placeholder="çœ/å¸‚/åŒº">
                                    </div>
                                </div>
                            </div>

                            <!-- Contact Info -->
                            <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                                <h3 class="text-sm font-bold text-green-800 mb-3 border-b border-gray-100 pb-2">è”ç³»æ–¹å¼</h3>
                                <div>
                                    <label class="block text-xs text-gray-500 mb-1">é‚®ç®±åœ°å€</label>
                                    <input type="email" id="edit-email" class="w-full border border-gray-300 rounded p-2 text-sm focus:border-green-500 outline-none" value="${u.email || ''}" placeholder="example@email.com">
                                </div>
                            </div>

                            <button onclick="app.saveProfile()" class="w-full bg-green-600 text-white py-3 rounded-lg font-bold shadow-md mt-2 hover:bg-green-700 transition">ä¿å­˜ä¿®æ”¹</button>
                        </div>
                    </div>
                `;
            },

            saveProfile() {
                const name = document.getElementById('edit-name').value;
                const bio = document.getElementById('edit-bio').value;
                const email = document.getElementById('edit-email').value;
                const farmName = document.getElementById('edit-farm-name').value;
                const farmType = document.getElementById('edit-farm-type').value;
                const farmAddr = document.getElementById('edit-farm-addr').value;

                if(name) db.user.name = name;
                if(bio) db.user.bio = bio;
                if(email) db.user.email = email;
                
                if(!db.user.farmInfo) db.user.farmInfo = {};
                if(farmName) db.user.farmInfo.name = farmName;
                if(farmType) db.user.farmInfo.type = farmType;
                if(farmAddr) db.user.farmInfo.address = farmAddr;

                alert('èµ„æ–™å·²æ›´æ–°');
                this.navigate('mine');
            },

            // Actions
            addToCart(id) {
                if(!this.state.cart.includes(id)) {
                    this.state.cart.push(id);
                    this.updateHeader();
                    // Refresh current view to update badge
                    this.navigate(this.state.view, id);
                    alert('å·²åŠ å…¥è´­ç‰©è½¦');
                }
            },

            buy(id, price) {
                if(confirm(`ç¡®è®¤æ”¯ä»˜ Â¥${price} è´­ä¹°?`)) {
                    this.state.purchased.push(id);
                    this.state.points += Math.floor(price * 10);
                    this.navigate('course-detail', id); // Refresh to show bought state
                    alert(`è´­ä¹°æˆåŠŸ! è·å¾— ${Math.floor(price * 10)} ç§¯åˆ†`);
                }
            },

            startTimer() {
                setInterval(() => {
                    const now = new Date();
                    const end = new Date();
                    end.setHours(23, 59, 59);
                    const diff = end - now;
                    if(diff > 0) {
                        const h = String(Math.floor(diff / 3600000 % 24)).padStart(2, '0');
                        const m = String(Math.floor(diff / 60000 % 60)).padStart(2, '0');
                        const s = String(Math.floor(diff / 1000 % 60)).padStart(2, '0');
                        document.querySelectorAll('.timer').forEach(el => el.innerText = `${h}:${m}:${s}`);
                    }
                }, 1000);
            }
        };

        document.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>
